# SecNode 项目重构实施任务

## 任务概述

本文档列出了 SecNode 项目重构的具体实施任务，按照优先级和依赖关系组织。

## 实施任务

- [x] 1. 删除云端功能模块
  - 删除 `secnode/cloud.py` 文件
  - 从 `secnode/__init__.py` 中移除 CloudSyncer 导入和导出
  - 更新 `pyproject.toml` 移除 aiohttp 依赖
  - _需求: 1.1, 1.2, 1.3_

- [x] 2. 修改 GuardNode 和 WrapperNode 类
  - 从 `secnode/graph.py` 中移除 CloudSyncer 相关代码
  - 移除 cloud_syncer 参数和相关逻辑
  - 简化异步日志记录逻辑
  - _需求: 1.4_

- [x] 3. 创建公共工具模块
  - 创建 `secnode/utils/__init__.py`
  - 创建 `secnode/utils/common.py` 包含公共函数
  - 实现内容提取和风险计算的通用方法
  - _需求: 3.1, 3.4_

- [x] 4. 优化策略类中的重复代码
  - 提取 `secnode/policies/builtin.py` 中的重复内容提取逻辑
  - 统一异常处理模式
  - 优化风险分数计算逻辑
  - _需求: 3.2, 3.3_

- [x] 5. 创建测试工具模块
  - 创建 `tests/utils/__init__.py`
  - 创建 `tests/utils/helpers.py` 包含测试工具函数
  - 创建 `tests/utils/fixtures.py` 包含测试数据
  - _需求: 3.1_

- [x] 6. 重组测试文件结构
  - 创建 `tests/conftest.py` pytest 配置文件
  - 创建 `tests/unit/` 目录结构
  - 将现有测试文件迁移到新结构中
  - _需求: 2.1, 2.2_

- [x] 7. 合并和优化测试代码
  - 合并 `test_basic_policies.py` 和 `test_all_policies.py`
  - 使用公共测试工具函数重写测试
  - 删除重复的测试逻辑
  - _需求: 2.3, 3.1_

- [x] 8. 清理根目录测试文件
  - 删除根目录下的 `test_*.py` 文件
  - 确保所有测试功能已迁移到新结构
  - 验证测试覆盖率没有降低
  - _需求: 2.3_

- [x] 9. 更新文档和示例
  - 更新 `README.md` 移除云端功能相关内容
  - 更新代码示例移除 CloudSyncer 使用
  - 更新 `ARCHITECTURE.md` 反映新的架构
  - _需求: 1.5, 4.3_

- [x] 10. 验证和测试
  - 运行所有测试确保功能正常
  - 验证包安装和导入正常
  - 检查向后兼容性
  - _需求: 2.5, 4.4_

## 任务执行顺序

### 第一阶段：云端功能删除
- 任务 1: 删除云端功能模块
- 任务 2: 修改 GuardNode 和 WrapperNode 类

### 第二阶段：代码优化
- 任务 3: 创建公共工具模块
- 任务 4: 优化策略类中的重复代码

### 第三阶段：测试重构
- 任务 5: 创建测试工具模块
- 任务 6: 重组测试文件结构
- 任务 7: 合并和优化测试代码
- 任务 8: 清理根目录测试文件

### 第四阶段：文档更新和验证
- 任务 9: 更新文档和示例
- 任务 10: 验证和测试

## 风险和注意事项

1. **向后兼容性**: 确保核心 API 保持不变
2. **测试覆盖**: 重构过程中不能降低测试覆盖率
3. **功能完整性**: 删除云端功能后核心安全功能必须完整
4. **依赖管理**: 仔细检查依赖删除不会影响其他功能